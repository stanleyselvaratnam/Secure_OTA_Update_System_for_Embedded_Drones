header:
  version: 11

# Définition des dépôts à cloner et des layers à activer
repos:
  poky:
    url: "https://git.yoctoproject.org/poky.git"
    refspec: "scarthgap"
    layers:
      meta:
      meta-poky:
      meta-yocto-bsp:

  meta-openembedded:
    url: "https://git.openembedded.org/meta-openembedded"
    refspec: "scarthgap"
    layers:
      meta-oe:
      meta-networking:
      meta-python:
  
  meta-mender:
    url: "https://github.com/mendersoftware/meta-mender.git"
    refspec: "scarthgap"
    layers:
      meta-mender-core:
      meta-mender-demo:

# Configuration de la build
build_system: oe

target:
  - u-boot
  - core-image-base

machine: genericarm64

distro: poky

# Variables injectées dans conf/local.conf
local_conf_header:
  my-config: |
    PACKAGE_CLASSES ?= "package_rpm"
    EXTRA_IMAGE_FEATURES ?= "debug-tweaks ssh-server-openssh"
    IMAGE_INSTALL:append = " htop vim"


    # Activer le support de GPU pour RPi
    RPI_USE_U_BOOT = "1"

    # Ajout du bootloader
    IMAGE_INSTALL:remove = "grub"
    UBOOT_MACHINE = "qemu_arm64_defconfig"
    IMAGE_BOOT_FILES = "u-boot.bin"
    IMAGE_CLASSES = ""
    PREFERRED_PROVIDER_virtual/bootloader = "u-boot"

    # Configuration Mender (exemple générique ARM64)
    MENDER_ARTIFACT_NAME = "release-1"
    MENDER_SERVER_URL = "https://eu.hosted.mender.io"
    MENDER_TENANT_TOKEN = "AVi5j0YkJYNeYRamqwzY2r9WRz3sJo5nbGDGaE0uXtQ"
    IMAGE_INSTALL:append = " mender-client"
    # Ajoute pour le partitionnement GPT si besoin
    MENDER_STORAGE_TOTAL_SIZE_MB = "4096"
    
    # Limiter la mémoire utilisée via parallélisme
    BB_NUMBER_THREADS = "10"
    PARALLEL_MAKE = "-j 10"
