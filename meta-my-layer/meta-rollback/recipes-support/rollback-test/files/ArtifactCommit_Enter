#!/bin/sh
# Mender State Script - ArtifactCommit_Leave
# Ce script est appelé après que le client tente de "committer" une mise à jour.
# En retournant un code d’erreur, on force un rollback.

LOGGER_TAG="rollback-test"

echo "[rollback-test] Échec volontaire du commit - rollback attendu." | systemd-cat -t ${LOGGER_TAG}

# On logge aussi sur stdout pour debug local
echo "[rollback-test] Échec volontaire du commit - rollback attendu."

# Attendre un peu pour laisser systemd journaliser proprement
sleep 2

# Retourner 1 = échec => rollback
exit 1
