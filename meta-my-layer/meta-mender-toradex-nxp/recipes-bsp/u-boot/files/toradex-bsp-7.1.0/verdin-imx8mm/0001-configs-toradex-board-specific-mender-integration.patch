From 9eddf3f3b4303706db9c921d4cce8faa3dd13b70 Mon Sep 17 00:00:00 2001
From: kas User <kas@example.com>
Date: Tue, 15 Apr 2025 19:54:51 +0000
Subject: [PATCH] configs: verdin-imx8mm: mender integration

---
 configs/verdin-imx8mm_defconfig | 8 +++++---
 include/configs/verdin-imx8mm.h | 2 ++
 2 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/configs/verdin-imx8mm_defconfig b/configs/verdin-imx8mm_defconfig
index 7c6c789edc4..f6e8b6ec298 100644
--- a/configs/verdin-imx8mm_defconfig
+++ b/configs/verdin-imx8mm_defconfig
@@ -5,8 +5,10 @@ CONFIG_SYS_MALLOC_LEN=0x2000000
 CONFIG_SPL_GPIO=y
 CONFIG_SPL_LIBCOMMON_SUPPORT=y
 CONFIG_SPL_LIBGENERIC_SUPPORT=y
-CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xFFFFDE00
+CONFIG_ENV_SIZE=0x4000
+CONFIG_ENV_OFFSET=0x800000
+CONFIG_ENV_OFFSET_REDUND=0x1000000
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
 CONFIG_DM_GPIO=y
 CONFIG_DEFAULT_DEVICE_TREE="freescale/imx8mm-verdin-wifi-dev"
 CONFIG_SPL_TEXT_BASE=0x7E1000
@@ -84,7 +86,7 @@ CONFIG_SPL_OF_CONTROL=y
 CONFIG_ENV_OVERWRITE=y
 CONFIG_ENV_IS_IN_MMC=y
 CONFIG_SYS_RELOC_GD_ENV_ADDR=y
-CONFIG_SYS_MMC_ENV_PART=1
+CONFIG_SYS_MMC_ENV_PART=0
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_USE_ETHPRIME=y
 CONFIG_ETHPRIME="eth0"
diff --git a/include/configs/verdin-imx8mm.h b/include/configs/verdin-imx8mm.h
index 12d2b682305..921cb6ffd81 100644
--- a/include/configs/verdin-imx8mm.h
+++ b/include/configs/verdin-imx8mm.h
@@ -55,6 +55,8 @@
 /* Environment in eMMC, before config block at the end of 1st "boot sector" */
 #endif
 
+#define CONFIG_BOOTCOUNT_ENV
+#define CONFIG_BOOTCOUNT_LIMIT
 #define CFG_SYS_SDRAM_BASE           0x40000000
 
 /* SDRAM configuration */
